<?xml version="1.0" encoding="ISO-8859-1"?>
<model version="2.1">
  <id>d6ca0c4a-6d65-4752-930b-c5fa72874a59</id>
  <name>Create CodeGen Handler</name>
  <changecounter>14</changecounter>
  <sib>
    <id>6ec4d4e6-7c89-44fe-8552-f555aa651230</id>
    <name>RunStringTemplate</name>
    <label>RunStringTemplate</label>
    <sib-uid>script-sibs/RunStringTemplate</sib-uid>
    <taxonomy>de.jabc.sib.common.script.RunStringTemplate</taxonomy>
    <position>670.0,228.0</position>
    <parameter name="append">
      <boolean>true</boolean>
    </parameter>
    <parameter name="individualVariables">
      <boolean>true</boolean>
    </parameter>
    <parameter name="result">
      <de.metaframe.jabc.framework.sib.parameter.ContextKey>
        <ContextKeyFoundation>
          <key>handlerClassContent</key>
          <scope>GLOBAL</scope>
          <scopeMutable>true</scopeMutable>
        </ContextKeyFoundation>
      </de.metaframe.jabc.framework.sib.parameter.ContextKey>
    </parameter>
    <parameter name="template">
      <string>package $handlersPackageName$;

import graphmodel.GraphModel;

import org.eclipse.core.commands.AbstractHandler;
import org.eclipse.core.commands.ExecutionEvent;
import org.eclipse.core.commands.ExecutionException;
import org.eclipse.emf.common.util.URI;
import org.eclipse.emf.ecore.EObject;
import org.eclipse.emf.ecore.resource.Resource;
import org.eclipse.emf.ecore.resource.ResourceSet;
import org.eclipse.emf.ecore.resource.impl.ResourceSetImpl;
import org.eclipse.graphiti.ui.editor.DiagramEditorInput;
import org.eclipse.ui.IEditorPart;
import org.eclipse.ui.IWorkbenchWindow;
import org.eclipse.ui.handlers.HandlerUtil;
import org.eclipse.core.resources.IProject;
import org.eclipse.core.resources.IResource;
import org.eclipse.core.resources.ResourcesPlugin;

/**
 * Our sample handler extends AbstractHandler, an IHandler base class.
 * @see org.eclipse.core.commands.IHandler
 * @see org.eclipse.core.commands.AbstractHandler
 */
public class $graphModelName$CodeGenerationHandler extends AbstractHandler {
	/**
	 * The constructor.
	 */
	public $graphModelName$CodeGenerationHandler() {
		
	}

	/**
	 * the command has been executed, so extract extract the needed information
	 * from the application context.
	 */
	public Object execute(ExecutionEvent event) throws ExecutionException {
				IWorkbenchWindow window = HandlerUtil.getActiveWorkbenchWindowChecked(event);
		
		IEditorPart activeEditor =  window.getActivePage().getActiveEditor();
		
		DiagramEditorInput input = (DiagramEditorInput)activeEditor.getEditorInput();
		URI uri = input.getUri();
		System.out.println(uri.toPlatformString(true));
		try{
			ResourceSet set = new ResourceSetImpl();
			Resource res = set.createResource(uri);
			graphmodel.GraphModel graphModel =null;
			res.load(null);
			for(EObject obj: res.getContents()){
				if(obj instanceof GraphModel){
					graphModel = (GraphModel)obj;
					break;
				}
				
			}
			if(graphModel!=null){
			
				$implementingClassName$ generator = new $implementingClassName$();
				IProject project = null;
				if (uri.isPlatformResource()) {
					String platformString = uri.toPlatformString(true);
					IResource s = ResourcesPlugin.getWorkspace().getRoot().findMember(platformString);
					project = s.getProject();
				}
				org.eclipse.core.runtime.IPath outlet = project.getProjectRelativePath().append(&quot;/src-gen/&quot;);
				generator.generate(graphModel,outlet);
			}
			return null;
		}catch(Exception e){
			return null;		
		}
		
	}
}</string>
    </parameter>
    <finalbranches>default</finalbranches>
    <finalbranches>error</finalbranches>
  </sib>
  <sib>
    <id>64fc12bc-3e9d-41d2-99f6-8b000849df01</id>
    <name>PutExpression</name>
    <label>Put CodeGenHandler Name</label>
    <sib-uid>basic-sibs/PutExpression</sib-uid>
    <taxonomy>de.jabc.sib.common.basic.PutExpression</taxonomy>
    <position>149.5,228.0</position>
    <parameter name="resolve">
      <boolean>true</boolean>
    </parameter>
    <parameter name="value">
      <de.metaframe.common.sib.parameter.ContextExpression>
        <ContextExpressionFoundation>
          <expression>${graphModelName}CodeGenerationHandler</expression>
          <clazz>java.lang.Object</clazz>
          <classMutable>true</classMutable>
        </ContextExpressionFoundation>
      </de.metaframe.common.sib.parameter.ContextExpression>
    </parameter>
    <parameter name="variable">
      <de.metaframe.jabc.framework.sib.parameter.ContextKey>
        <ContextKeyFoundation>
          <key>handlerClassName</key>
          <scope>GLOBAL</scope>
          <scopeMutable>true</scopeMutable>
        </ContextKeyFoundation>
      </de.metaframe.jabc.framework.sib.parameter.ContextKey>
    </parameter>
    <finalbranches>default</finalbranches>
    <finalbranches>error</finalbranches>
    <userobject key="ABC$START">
      <boolean>true</boolean>
    </userobject>
  </sib>
  <sib>
    <id>cac3bb48-d9e9-440f-b4d5-7a7d8993f6a2</id>
    <name>WriteJavaFile</name>
    <label>WriteJavaFile</label>
    <sib-uid>genesys-sibs/WriteJavaFile</sib-uid>
    <taxonomy>de.jabc.sib.genesys.WriteJavaFile</taxonomy>
    <position>943.0,228.0</position>
    <parameter name="baseDirectory">
      <de.metaframe.jabc.framework.sib.parameter.ContextKey>
        <ContextKeyFoundation>
          <key>sourcePath</key>
          <scope>GLOBAL</scope>
          <scopeMutable>true</scopeMutable>
        </ContextKeyFoundation>
      </de.metaframe.jabc.framework.sib.parameter.ContextKey>
    </parameter>
    <parameter name="beautify">
      <boolean>true</boolean>
    </parameter>
    <parameter name="beautifyMethod">
      <de.metaframe.common.sib.parameter.ListBox>
        <ListBoxFoundation>
          <list>
            <string>Eclipse</string>
            <string>Jalopy</string>
          </list>
          <selected>0</selected>
        </ListBoxFoundation>
      </de.metaframe.common.sib.parameter.ListBox>
    </parameter>
    <parameter name="className">
      <de.metaframe.jabc.framework.sib.parameter.ContextKey>
        <ContextKeyFoundation>
          <key>handlerClassName</key>
          <scope>GLOBAL</scope>
          <scopeMutable>true</scopeMutable>
        </ContextKeyFoundation>
      </de.metaframe.jabc.framework.sib.parameter.ContextKey>
    </parameter>
    <parameter name="fileContent">
      <de.metaframe.jabc.framework.sib.parameter.ContextKey>
        <ContextKeyFoundation>
          <key>handlerClassContent</key>
          <scope>GLOBAL</scope>
          <scopeMutable>true</scopeMutable>
        </ContextKeyFoundation>
      </de.metaframe.jabc.framework.sib.parameter.ContextKey>
    </parameter>
    <parameter name="packageName">
      <de.metaframe.jabc.framework.sib.parameter.ContextKey>
        <ContextKeyFoundation>
          <key>handlersPackageName</key>
          <scope>GLOBAL</scope>
          <scopeMutable>true</scopeMutable>
        </ContextKeyFoundation>
      </de.metaframe.jabc.framework.sib.parameter.ContextKey>
    </parameter>
    <finalbranches>default</finalbranches>
    <finalbranches>error</finalbranches>
  </sib>
  <edge>
    <source>64fc12bc-3e9d-41d2-99f6-8b000849df01</source>
    <target>4c587e73-fd65-4b34-9f50-d9bd212d1d2a</target>
    <point>258.0,246.3272727272727</point>
    <point>717.0,246.3272727272727</point>
    <labelposition>500.0,0.0</labelposition>
    <branch>default</branch>
  </edge>
  <edge>
    <source>6ec4d4e6-7c89-44fe-8552-f555aa651230</source>
    <target>cac3bb48-d9e9-440f-b4d5-7a7d8993f6a2</target>
    <point>528.0,405.15</point>
    <point>972.0,252.525</point>
    <labelposition>500.0,0.0</labelposition>
    <branch>default</branch>
  </edge>
  <sib>
    <id>4c587e73-fd65-4b34-9f50-d9bd212d1d2a</id>
    <name>PutExpression_1</name>
    <label>Put Handler Package</label>
    <sib-uid>basic-sibs/PutExpression</sib-uid>
    <taxonomy>de.jabc.sib.common.basic.PutExpression</taxonomy>
    <position>424.5,228.0</position>
    <parameter name="resolve">
      <boolean>true</boolean>
    </parameter>
    <parameter name="value">
      <de.metaframe.common.sib.parameter.ContextExpression>
        <ContextExpressionFoundation>
          <expression>${codegenPackage}.handlers</expression>
          <clazz>java.lang.Object</clazz>
          <classMutable>true</classMutable>
        </ContextExpressionFoundation>
      </de.metaframe.common.sib.parameter.ContextExpression>
    </parameter>
    <parameter name="variable">
      <de.metaframe.jabc.framework.sib.parameter.ContextKey>
        <ContextKeyFoundation>
          <key>handlersPackageName</key>
          <scope>GLOBAL</scope>
          <scopeMutable>true</scopeMutable>
        </ContextKeyFoundation>
      </de.metaframe.jabc.framework.sib.parameter.ContextKey>
    </parameter>
    <finalbranches>default</finalbranches>
    <finalbranches>error</finalbranches>
  </sib>
  <edge>
    <source>4c587e73-fd65-4b34-9f50-d9bd212d1d2a</source>
    <target>6ec4d4e6-7c89-44fe-8552-f555aa651230</target>
    <point>717.0,259.92</point>
    <point>528.0,398.52</point>
    <labelposition>500.0,0.0</labelposition>
    <branch>default</branch>
  </edge>
  <values/>
  <branch>
    <name>error</name>
    <branch>error</branch>
    <sib>64fc12bc-3e9d-41d2-99f6-8b000849df01</sib>
  </branch>
  <branch>
    <name>error</name>
    <branch>error</branch>
    <sib>6ec4d4e6-7c89-44fe-8552-f555aa651230</sib>
  </branch>
  <branch>
    <name>error</name>
    <branch>error</branch>
    <sib>4c587e73-fd65-4b34-9f50-d9bd212d1d2a</sib>
  </branch>
  <branch>
    <name>error</name>
    <branch>error</branch>
    <sib>cac3bb48-d9e9-440f-b4d5-7a7d8993f6a2</sib>
  </branch>
  <branch>
    <name>default</name>
    <branch>default</branch>
    <sib>cac3bb48-d9e9-440f-b4d5-7a7d8993f6a2</sib>
  </branch>
</model>